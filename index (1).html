<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>WMP XP Web - Completo</title>

<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
* { box-sizing:border-box; margin:0; padding:0; font-family: Tahoma, sans-serif; }

body {
    background:#c0c0c0;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    position: relative;
}

#wmp {
    width:80vw;
    max-width:900px;
    aspect-ratio:1.6/1;
    background:linear-gradient(#c0c0c0,#999);
    border:2px solid #000080;
    display:flex;
    flex-direction:column;
    position: relative;
    z-index:1;
}

/* Top bar */
#topbar {
    background:#000080;
    color:#fff;
    font-size:12px;
    font-weight:bold;
    padding:3px 6px;
    display:flex;
    justify-content:space-between;
}

/* Main */
#main {
    flex:1;
    display:flex;
    min-height:0;
}

/* Visualizer */
#visualizerContainer {
    flex:1;
    background:#000;
    position:relative;
    overflow:hidden;
}

#visualizer {
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    display:block;
}

/* Info panel */
#info {
    width:220px;
    background:#e0e0e0;
    display:flex;
    flex-direction:column;
    padding:5px;
    gap:6px;
}

#cover {
    aspect-ratio:1/1;
    background:#808080;
    border:1px solid #000;
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:64px;
    color:white;
}

#playlistContainer {
    flex:1;
    background:white;
    border:1px solid #000080;
    overflow-y:auto;
}

#playlist li {
    list-style:none;
    font-size:12px;
    padding:2px 4px;
    cursor:pointer;
}
#playlist li.active {
    background:#00ff00;
    color:black;
}

/* Buttons */
.xp-btn {
    background:#e0e0e0;
    border:1px solid #808080;
    font-size:12px;
    padding:4px;
    cursor:pointer;
}

/* Controls */
#controls {
    height:44px;
    background:#d0d0d0;
    display:flex;
    align-items:center;
    gap:6px;
    padding:5px;
}

.ctrl-btn {
    width:30px;
    height:30px;
}

/* Progress */
#progressContainer {
    flex:1;
    height:8px;
    background:white;
    border:1px solid #808080;
    position:relative;
    cursor:pointer;
}

#progress {
    height:100%;
    width:0%;
    background:#00ff00;
}

#progressPointer {
    position:absolute;
    top:-4px;
    width:8px;
    height:16px;
    background:#00ff00;
    transform:translateX(-50%);
}

/* Volume */
#volume {
    width:80px;
}

#fileInput { display:none; }

/* Overlay Drag & Drop */
#dropOverlay {
    position:fixed;
    top:0;
    left:0;
    width:100vw;
    height:100vh;
    background:rgba(0,0,0,0.5);
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    color:white;
    font-size:20px;
    font-weight:bold;
    z-index:1000;
    pointer-events:none;
    opacity:0;
    transition: opacity 0.2s ease;
}

#dropOverlay.visible {
    opacity:1;
    pointer-events:auto;
}

#dropOverlay i {
    font-size:64px;
    margin-bottom:10px;
}
</style>
</head>
<body>

<div id="wmp">
    <div id="topbar">
        <span>Windows Media Player</span>
        <span>Now Playing</span>
    </div>

    <div id="main">
        <div id="visualizerContainer">
            <canvas id="visualizer"></canvas>
        </div>

        <div id="info">
            <div id="cover">üéµ</div>
            <div id="playlistContainer">
                <ul id="playlist"></ul>
            </div>
            <button class="xp-btn" id="addFileBtn">Add File</button>
        </div>
    </div>

    <div id="controls">
        <button class="ctrl-btn" id="prev">‚èÆ</button>
        <button class="ctrl-btn" id="play">‚ñ∫</button>
        <button class="ctrl-btn" id="pause">‚ùö‚ùö</button>
        <button class="ctrl-btn" id="stop">‚ñ†</button>
        <button class="ctrl-btn" id="next">‚è≠</button>
        <button class="ctrl-btn" id="fullscreenBtn">üñµ</button>

        <div id="progressContainer">
            <div id="progress"></div>
            <div id="progressPointer"></div>
        </div>

        üîä <input type="range" id="volume" min="0" max="1" step="0.01" value="1">
    </div>
</div>

<!-- Overlay -->
<div id="dropOverlay">
    <i class="material-icons">file_upload</i>
    Suelta para cargar
</div>

<input type="file" id="fileInput" multiple accept="audio/*">
<audio id="audio"></audio>

<script>
/* ==========================
   VARIABLES
========================== */
const audio = document.getElementById("audio");
const canvas = document.getElementById("visualizer");
const ctx = canvas.getContext("2d");
const playlistEl = document.getElementById("playlist");
const fileInput = document.getElementById("fileInput");
const addFileBtn = document.getElementById("addFileBtn");
const volumeSlider = document.getElementById("volume");
const dropOverlay = document.getElementById("dropOverlay");
const fullscreenBtn = document.getElementById("fullscreenBtn");

let audioContext, analyser, dataArray, bufferLength;
const numBars = 120;
let bars = new Array(numBars).fill(0);
let peaks = new Array(numBars).fill(0);
const minFreqRatio = 0.02;
const maxFreqRatio = 0.55;

let playlist = [];
let currentIndex = -1;

/* ==========================
   CANVAS RESIZE
========================== */
function resize(){
    canvas.width  = canvas.clientWidth;
    canvas.height = canvas.clientHeight;
}
window.addEventListener("resize", resize);
resize();

/* ==========================
   PLAYLIST
========================== */
addFileBtn.onclick = () => fileInput.click();
fileInput.onchange = () => addFiles([...fileInput.files]);

function addFiles(files){
    const audioFiles = files.filter(f => f.type.startsWith("audio/"));
    audioFiles.forEach(file => {
        playlist.push(file);
        const li = document.createElement("li");
        li.textContent = file.name;
        li.onclick = () => playIndex(playlist.indexOf(file));
        playlistEl.appendChild(li);
    });
    if(currentIndex === -1 && playlist.length) playIndex(0);
}

function playIndex(i){
    if(i < 0 || i >= playlist.length) return;
    currentIndex = i;
    audio.src = URL.createObjectURL(playlist[i]);
    audio.play();
    updatePlaylist();
}

function updatePlaylist(){
    [...playlistEl.children].forEach((li,i)=>{
        li.classList.toggle("active", i===currentIndex);
    });
}

/* ==========================
   CONTROLES
========================== */
document.getElementById("play").onclick  = () => audio.play();
document.getElementById("pause").onclick = () => audio.pause();
document.getElementById("stop").onclick  = () => { audio.pause(); audio.currentTime = 0; };
document.getElementById("next").onclick  = () => playIndex((currentIndex+1)%playlist.length);
document.getElementById("prev").onclick  = () => playIndex((currentIndex-1+playlist.length)%playlist.length);
volumeSlider.oninput = e => audio.volume = e.target.value;

const progress = document.getElementById("progress");
const progressPointer = document.getElementById("progressPointer");
document.getElementById("progressContainer").onclick = e => {
    const r = e.currentTarget.getBoundingClientRect();
    audio.currentTime = (e.clientX - r.left) / r.width * audio.duration;
};
audio.ontimeupdate = () => {
    if(audio.duration){
        const pct = audio.currentTime / audio.duration * 100;
        progress.style.width = pct + "%";
        progressPointer.style.left = pct + "%";
    }
};

/* ==========================
   AUDIO CONTEXT
========================== */
audio.onplay = () => {
    if(audioContext) return;
    audioContext = new AudioContext();
    analyser = audioContext.createAnalyser();
    analyser.fftSize = 512;
    bufferLength = analyser.frequencyBinCount;
    dataArray = new Uint8Array(bufferLength);

    const src = audioContext.createMediaElementSource(audio);
    src.connect(analyser);
    analyser.connect(audioContext.destination);
    visualize();
};

/* ==========================
   VISUALIZER XP
========================== */
function visualize(){
    requestAnimationFrame(visualize);
    analyser.getByteFrequencyData(dataArray);
    ctx.clearRect(0,0,canvas.width,canvas.height);

    const gap = 1;
    const barWidth = (canvas.width - gap*(numBars-1))/numBars;
    const start = Math.floor(bufferLength*minFreqRatio);
    const end   = Math.floor(bufferLength*maxFreqRatio);
    const usable = end-start;

    for(let i=0;i<numBars;i++){
        const bin = start + Math.floor(i/numBars*usable);
        let v = Math.pow(dataArray[bin]/255,0.7);

        bars[i] = bars[i]*0.7 + v*0.3;
        const h = bars[i]*canvas.height;

        if(h > peaks[i]) peaks[i] = h;
        else peaks[i] -= canvas.height*0.002;
        peaks[i] = Math.max(peaks[i],h);

        const grad = ctx.createLinearGradient(0,canvas.height-h,0,canvas.height);
        grad.addColorStop(0,"#7CFF7C");
        grad.addColorStop(1,"#00AA00");

        const x = i*(barWidth + gap);
        ctx.fillStyle = grad;
        ctx.fillRect(x, canvas.height-h, barWidth, h);

        ctx.fillStyle="#E0FFE0";
        ctx.fillRect(x, canvas.height-peaks[i]-2, barWidth, 2);
    }
}

/* ==========================
   DRAG & DROP OVERLAY
========================== */
let dragCounter = 0;
document.addEventListener("dragenter", e => {
    e.preventDefault();
    dragCounter++;
    if([...e.dataTransfer.items].some(i => i.kind==="file")){
        dropOverlay.classList.add("visible");
    }
});
document.addEventListener("dragleave", e => {
    e.preventDefault();
    dragCounter--;
    if(dragCounter <= 0){
        dragOverlayOff();
    }
});
document.addEventListener("dragover", e => {
    e.preventDefault();
    e.dataTransfer.dropEffect="copy";
});
document.addEventListener("drop", e => {
    e.preventDefault();
    dragCounter=0;
    dragOverlayOff();
    const files = [...e.dataTransfer.files];
    if(files.length) addFiles(files);
});
function dragOverlayOff(){
    dropOverlay.classList.remove("visible");
}

/* ==========================
   FULLSCREEN
========================== */
fullscreenBtn.onclick = () => {
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
    } else {
        document.exitFullscreen();
    }
};

document.addEventListener('fullscreenchange', () => {
    const wmp = document.getElementById("wmp");
    if (document.fullscreenElement) {
        wmp.style.width = '100vw';
        wmp.style.height = '100vh';
        wmp.style.maxWidth = '100vw';
        wmp.style.aspectRatio = 'unset';
    } else {
        wmp.style.width = '80vw';
        wmp.style.maxWidth = '900px';
        wmp.style.aspectRatio = '1.6/1';
        wmp.style.height = 'auto';
    }
    resize();
});
</script>

</body>
</html>
